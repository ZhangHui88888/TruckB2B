# å¤–è´¸ç‹¬ç«‹ç«™æŠ€æœ¯æ–¹æ¡ˆ

## æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·è®¿é—®                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Cloudflare Pages (å‰ç«¯)                         â”‚
â”‚                    - é™æ€ç½‘ç«™æ‰˜ç®¡                                â”‚
â”‚                    - å…¨çƒCDNåŠ é€Ÿ                                 â”‚
â”‚                    - å…è´¹SSLè¯ä¹¦                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Cloudflare Workers (åç«¯)                       â”‚
â”‚                    - APIè¯·æ±‚è½¬å‘                                 â”‚
â”‚                    - å¤§æ¨¡å‹è°ƒç”¨                                  â”‚
â”‚                    - é‚®ä»¶é€šçŸ¥                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                 â†“                 â†“                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Supabase    â”‚ â”‚   DeepSeek    â”‚ â”‚   Resend      â”‚ â”‚ Cloudflare R2 â”‚
â”‚   å‘é‡æ•°æ®åº“   â”‚ â”‚   å¤§æ¨¡å‹API   â”‚ â”‚   é‚®ä»¶æœåŠ¡    â”‚ â”‚   å›¾ç‰‡å­˜å‚¨    â”‚
â”‚   çŸ¥è¯†åº“æ£€ç´¢   â”‚ â”‚   æ™ºèƒ½å¯¹è¯    â”‚ â”‚   è¯¢ç›˜é€šçŸ¥    â”‚ â”‚   äº§å“å›¾ç‰‡    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æœåŠ¡é€‰å‹

### 1. å‰ç«¯æ‰˜ç®¡ - Cloudflare Pages

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| è´¹ç”¨ | å…è´¹ |
| åŠŸèƒ½ | é™æ€ç½‘ç«™æ‰˜ç®¡ã€å…¨çƒCDNã€è‡ªåŠ¨SSL |
| é™åˆ¶ | 500æ¬¡æ„å»º/æœˆï¼Œæ— é™å¸¦å®½ |

### 2. åç«¯æœåŠ¡ - Cloudflare Workers

| é¡¹ç›® | å…è´¹é¢åº¦ |
|------|----------|
| è¯·æ±‚æ•° | 10ä¸‡æ¬¡/å¤© |
| CPUæ—¶é—´ | 10ms/è¯·æ±‚ |
| å†…å­˜ | 128MB |
| è„šæœ¬å¤§å° | 1MB |

**é€‚åˆåœºæ™¯ï¼š**
- APIè¯·æ±‚è½¬å‘
- å¤§æ¨¡å‹è°ƒç”¨ï¼ˆè½¬å‘åˆ°OpenAI/Claudeï¼‰
- è¡¨å•å¤„ç†
- é‚®ä»¶è§¦å‘
- ç®€å•æ•°æ®æŸ¥è¯¢

**ä¸é€‚åˆåœºæ™¯ï¼š**
- æœ¬åœ°è¿è¡ŒAIæ¨¡å‹ï¼ˆå¦‚Ollamaï¼‰
- å¤æ‚è®¡ç®—ã€å›¾ç‰‡å¤„ç†
- éœ€è¦é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡

### 3. å‘é‡æ•°æ®åº“ - Supabase

| é¡¹ç›® | å…è´¹é¢åº¦ |
|------|----------|
| æ•°æ®åº“å­˜å‚¨ | 500MB |
| å‘é‡å­˜å‚¨ | åŒ…å«åœ¨å†… |
| APIè¯·æ±‚ | æ— é™åˆ¶ |

**ç”¨é€”ï¼š** çŸ¥è¯†åº“å­˜å‚¨ä¸æ£€ç´¢ï¼ˆRAGï¼‰

### 4. å›¾ç‰‡å­˜å‚¨ - Cloudflare R2

| é¡¹ç›® | å…è´¹é¢åº¦ |
|------|----------|
| å­˜å‚¨ç©ºé—´ | 10GB |
| è¯»å–è¯·æ±‚ | 1000ä¸‡æ¬¡/æœˆ |
| å†™å…¥è¯·æ±‚ | 100ä¸‡æ¬¡/æœˆ |
| å‡ºç«™æµé‡ | **å…è´¹** |

**å®¹é‡ä¼°ç®—ï¼š** 350å¼ å›¾ç‰‡ Ã— 500KB â‰ˆ 175MBï¼Œè¿œä½äº10GBé™åˆ¶

### 5. é‚®ä»¶æœåŠ¡ - Resend

| é¡¹ç›® | å…è´¹é¢åº¦ |
|------|----------|
| å‘é€é‡ | 100å°/å¤© |
| åŠŸèƒ½ | è¯¢ç›˜é€šçŸ¥ã€å®¢æˆ·æ¶ˆæ¯æé†’ |

### 6. WhatsApp Business API

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| å¹³å° | Meta WhatsApp Business Platform |
| å…è´¹é¢åº¦ | 1000æ¡å¯¹è¯/æœˆï¼ˆç”¨æˆ·å‘èµ·ï¼‰ |
| è¶…å‡ºè´¹ç”¨ | çº¦$0.005-0.08/æ¡ï¼ˆæŒ‰åœ°åŒºï¼‰ |
| åŠŸèƒ½ | æ¥æ”¶æ¶ˆæ¯ã€AIè‡ªåŠ¨å›å¤ã€ä¸»åŠ¨æ¨é€ |

**æ¥å…¥æ–¹å¼ï¼š**
- é€šè¿‡ Meta Business è´¦å·ç”³è¯· WhatsApp Business API
- é…ç½® Webhook åˆ° Cloudflare Worker
- æ”¯æŒ AI è‡ªåŠ¨å›å¤å®¢æˆ·æ¶ˆæ¯

### 7. å¤§æ¨¡å‹API

| æœåŠ¡å•† | ç‰¹ç‚¹ | ä»·æ ¼ |
|--------|------|------|
| **DeepSeekï¼ˆå·²é€‰ç”¨ï¼‰** | æ€§ä»·æ¯”æœ€é«˜ï¼Œæ€§èƒ½æ¥è¿‘ GPT-4o | $0.27/$1.10 æ¯ç™¾ä¸‡tokens |
| OpenAI GPT-4o-mini | æ”¯æŒå›¾ç‰‡è¯†åˆ«ï¼ˆå¤‡ç”¨ï¼‰ | $0.15/$0.60 æ¯ç™¾ä¸‡tokens |
| Claude | é•¿æ–‡æœ¬èƒ½åŠ›å¼º | $3.00/$15.00 æ¯ç™¾ä¸‡tokens |

> âœ… **å·²é€‰ç”¨ DeepSeek**ï¼šä»·æ ¼æ¯” OpenAI ä¾¿å®œçº¦ 10 å€ï¼Œæ€§èƒ½è¶³å¤Ÿå®¢æœåœºæ™¯ä½¿ç”¨

---

## æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. æ™ºèƒ½å®¢æœå¯¹è¯

```
å®¢æˆ·æé—® â†’ Worker â†’ SupabaseæŸ¥è¯¢ç›¸å…³çŸ¥è¯† â†’ æ‹¼æ¥Prompt â†’ å¤§æ¨¡å‹API â†’ è¿”å›ç­”æ¡ˆ
```

- å¯¹è¯å†å²ç”±å‰ç«¯ç»´æŠ¤ï¼Œæ¯æ¬¡è¯·æ±‚å¸¦ä¸Šå®Œæ•´å†å²
- Workeræ— çŠ¶æ€ï¼Œåªåšè½¬å‘å’Œæ‹¼æ¥
- å¯é€‰ï¼šå°†å¯¹è¯è®°å½•å­˜å…¥Supabaseåšåˆ†æ

### 2. è¯¢ç›˜é‚®ä»¶é€šçŸ¥

```
å®¢æˆ·å‘æ¶ˆæ¯ â†’ Worker â†’ 1. è°ƒç”¨å¤§æ¨¡å‹å›å¤
                    â†’ 2. è°ƒç”¨Resendå‘é‚®ä»¶é€šçŸ¥ç«™é•¿
```

### 3. äº§å“å›¾ç‰‡å±•ç¤º

```
äº§å“å›¾ç‰‡å­˜å‚¨åœ¨R2 â†’ é€šè¿‡CDNç›´æ¥è®¿é—® â†’ å…¨çƒåŠ é€Ÿï¼Œæµé‡å…è´¹
```

### 4. WhatsApp AI å®¢æœ

**ä¸»é¡µèŠå¤©å…¥å£ï¼š**
```html
<!-- æµ®åŠ¨WhatsAppæŒ‰é’® -->
<a href="https://wa.me/ä½ çš„å·ç ?text=Hi, I'm interested in your products" 
   class="whatsapp-float" target="_blank">
  <img src="whatsapp-icon.svg" alt="Chat on WhatsApp">
</a>
```

**AIè‡ªåŠ¨å›å¤æµç¨‹ï¼š**
```
å®¢æˆ·å‘é€WhatsAppæ¶ˆæ¯ 
    â†’ Meta Webhook æ¨é€åˆ° Cloudflare Worker
    â†’ Worker æŸ¥è¯¢ Supabase çŸ¥è¯†åº“
    â†’ è°ƒç”¨å¤§æ¨¡å‹ç”Ÿæˆå›å¤
    â†’ é€šè¿‡ WhatsApp API å‘é€å›å¤
    â†’ åŒæ—¶å‘é€é‚®ä»¶é€šçŸ¥ç«™é•¿
```

**Worker å¤„ç†é€»è¾‘ç¤ºä¾‹ï¼ˆæ”¯æŒ AI å¼€å…³ï¼‰ï¼š**
```javascript
// Cloudflare Worker - WhatsApp Webhook
export default {
  async fetch(request, env) {
    const body = await request.json();
    
    // éªŒè¯ Webhookï¼ˆMeta è¦æ±‚ï¼‰
    if (request.method === 'GET') {
      return verifyWebhook(request);
    }
    
    // å¤„ç†æ”¶åˆ°çš„æ¶ˆæ¯
    const message = body.entry?.[0]?.changes?.[0]?.value?.messages?.[0];
    if (!message) return new Response('OK');
    
    const userMessage = message.text?.body;
    const phoneNumber = message.from;
    
    // 0. ä¿å­˜å¯¹è¯è®°å½•ï¼ˆæ— è®º AI æ˜¯å¦å¼€å¯ï¼‰
    await saveConversation(env.SUPABASE, {
      phone: phoneNumber,
      message: userMessage,
      direction: 'incoming',
      timestamp: new Date().toISOString()
    });
    
    // 1. æ£€æŸ¥ AI å®¢æœæ˜¯å¦å¯ç”¨
    const settings = await getSettings(env.SUPABASE);
    if (!settings.ai_enabled) {
      // AI å…³é—­æ—¶ï¼Œåªå‘é‚®ä»¶é€šçŸ¥ï¼Œä¸è‡ªåŠ¨å›å¤
      await sendEmailNotification(env.RESEND_KEY, phoneNumber, userMessage, null);
      return new Response('OK');
    }
    
    // 2. æŸ¥è¯¢çŸ¥è¯†åº“
    const context = await queryKnowledgeBase(env.SUPABASE, userMessage);
    
    // 3. è°ƒç”¨AIç”Ÿæˆå›å¤
    const aiReply = await generateReply(env.DEEPSEEK_KEY, userMessage, context);
    
    // 4. å‘é€WhatsAppå›å¤
    await sendWhatsAppMessage(env.WHATSAPP_TOKEN, phoneNumber, aiReply);
    
    // 5. ä¿å­˜ AI å›å¤è®°å½•
    await saveConversation(env.SUPABASE, {
      phone: phoneNumber,
      message: aiReply,
      direction: 'outgoing',
      is_ai: true,
      timestamp: new Date().toISOString()
    });
    
    // 6. é‚®ä»¶é€šçŸ¥ç«™é•¿
    await sendEmailNotification(env.RESEND_KEY, phoneNumber, userMessage, aiReply);
    
    return new Response('OK');
  }
};

// ä¿å­˜å¯¹è¯è®°å½•
async function saveConversation(supabase, data) {
  await supabase.from('conversations').insert(data);
}

// è·å–ç³»ç»Ÿè®¾ç½®
async function getSettings(supabase) {
  const { data } = await supabase.from('settings').select('*').single();
  return data || { ai_enabled: false };
}
```

**Supabase å¯¹è¯è®°å½•è¡¨ï¼š**
```sql
-- å¯¹è¯è®°å½•è¡¨ï¼ˆç”¨äºçŸ¥è¯†åº“è®­ç»ƒï¼‰
CREATE TABLE conversations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  phone TEXT NOT NULL,
  message TEXT NOT NULL,
  direction TEXT NOT NULL,  -- 'incoming' æˆ– 'outgoing'
  is_ai BOOLEAN DEFAULT false,
  timestamp TIMESTAMPTZ DEFAULT NOW()
);

-- ç³»ç»Ÿè®¾ç½®è¡¨
CREATE TABLE settings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  ai_enabled BOOLEAN DEFAULT false,
  notify_email TEXT,
  updated_at TIMESTAMP DEFAULT NOW()
);

-- æ’å…¥é»˜è®¤è®¾ç½®ï¼ˆAI é»˜è®¤å…³é—­ï¼‰
INSERT INTO settings (ai_enabled, notify_email) 
VALUES (false, 'harry.zhang592802@gmail.com');
```

**ç®¡ç†åå° AI å¼€å…³ç»„ä»¶ï¼š**
```jsx
// components/AIToggle.jsx
import { useState, useEffect } from 'react';

export default function AIToggle() {
  const [enabled, setEnabled] = useState(false);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetch('/api/settings').then(r => r.json()).then(data => {
      setEnabled(data.ai_enabled);
      setLoading(false);
    });
  }, []);

  const toggle = async () => {
    const newValue = !enabled;
    await fetch('/api/settings', {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ ai_enabled: newValue })
    });
    setEnabled(newValue);
  };

  if (loading) return <div>åŠ è½½ä¸­...</div>;

  return (
    <div className="p-4 border rounded-lg">
      <h3 className="text-lg font-bold mb-2">AI å®¢æœè®¾ç½®</h3>
      <div className="flex items-center gap-4">
        <button
          onClick={toggle}
          className={`relative w-14 h-7 rounded-full transition-colors ${
            enabled ? 'bg-green-500' : 'bg-gray-300'
          }`}
        >
          <span className={`absolute top-1 w-5 h-5 bg-white rounded-full transition-transform ${
            enabled ? 'left-8' : 'left-1'
          }`} />
        </button>
        <span>{enabled ? 'âœ… AI è‡ªåŠ¨å›å¤å·²å¼€å¯' : 'â¸ï¸ AI å·²å…³é—­ï¼Œä»…è®°å½•å¯¹è¯'}</span>
      </div>
      <p className="text-gray-500 text-sm mt-2">
        å…³é—­æ—¶ï¼šå®¢æˆ·æ¶ˆæ¯ä¼šè®°å½•å¹¶é‚®ä»¶é€šçŸ¥ä½ ï¼Œä½†ä¸ä¼šè‡ªåŠ¨å›å¤
      </p>
    </div>
  );
}
```

---

## æˆæœ¬ä¼°ç®—

| æœåŠ¡ | æœˆè´¹ç”¨ |
|------|--------|
| Cloudflare Pages | å…è´¹ |
| Cloudflare Workers | å…è´¹ |
| Cloudflare R2 | å…è´¹ |
| Supabase | å…è´¹ |
| Resend | å…è´¹ |
| WhatsApp Business | å…è´¹ï¼ˆ1000æ¡/æœˆå†…ï¼‰ |
| **å¤§æ¨¡å‹API** | **æŒ‰é‡ä»˜è´¹** |
| **åŸŸå** | **çº¦$10-15/å¹´** |

### å¤§æ¨¡å‹APIè´¹ç”¨å‚è€ƒï¼ˆDeepSeekï¼‰

| ä½¿ç”¨é‡ | æœˆè´¹ç”¨ä¼°ç®— |
|--------|------------|
| 100æ¬¡å¯¹è¯/å¤© | çº¦$0.5-1 |
| 500æ¬¡å¯¹è¯/å¤© | çº¦$2-5 |
| 1000æ¬¡å¯¹è¯/å¤© | çº¦$5-10 |

> ğŸ’¡ DeepSeek æ¯” GPT-4o ä¾¿å®œçº¦ 10 å€ï¼Œå¤§å¹…é™ä½è¿è¥æˆæœ¬

---

## æ•°æ®éšç§è¯´æ˜

### ä½¿ç”¨ç¬¬ä¸‰æ–¹APIæ—¶

- ç”¨æˆ·é—®é¢˜å’ŒçŸ¥è¯†åº“å†…å®¹ä¼šå‘é€åˆ°APIæœåŠ¡å•†
- OpenAI/Claudeæ‰¿è¯ºAPIæ•°æ®ä¸ç”¨äºæ¨¡å‹è®­ç»ƒ
- æ•°æ®ä¿ç•™30å¤©ç”¨äºæ»¥ç”¨ç›‘æ§

### éšç§é£é™©è¯„ä¼°

| æ•°æ®ç±»å‹ | é£é™©ç­‰çº§ | å»ºè®® |
|----------|----------|------|
| äº§å“ä»‹ç»ã€FAQ | âœ… ä½ | å¯ç”¨API |
| å®¢æˆ·è¯¢ç›˜å†…å®¹ | âš ï¸ ä¸­ | å¯ç”¨API |
| å•†ä¸šæœºå¯†ã€æŠ¥ä»·ç­–ç•¥ | âŒ é«˜ | å»ºè®®è‡ªå»º |

### å¦‚éœ€å®Œå…¨ç§æœ‰åŒ–

éœ€ç§Ÿç”¨VPSï¼ˆ$20+/æœˆï¼‰è‡ªå»ºOllamaï¼Œä½†ä¼šç‰ºç‰²é€Ÿåº¦å’Œå¢åŠ ç»´æŠ¤æˆæœ¬ã€‚

---

## ä¸ä¼ ç»ŸVPSå¯¹æ¯”

| å¯¹æ¯”é¡¹ | Cloudflareæ–¹æ¡ˆ | ä¼ ç»ŸVPS |
|--------|----------------|---------|
| æœˆè´¹ç”¨ | åŸºæœ¬å…è´¹ | $5-20+ |
| è¿ç»´ | é›¶è¿ç»´ | éœ€è¦ç»´æŠ¤ |
| æ‰©å±•æ€§ | è‡ªåŠ¨æ‰©å±• | éœ€æ‰‹åŠ¨å‡çº§ |
| å…¨çƒåŠ é€Ÿ | å†…ç½®CDN | éœ€é¢å¤–é…ç½® |
| å¤æ‚åç«¯ | ä¸æ”¯æŒ | æ”¯æŒ |
| æœ¬åœ°AIæ¨¡å‹ | ä¸æ”¯æŒ | æ”¯æŒ |

---

## éƒ¨ç½²æ¸…å•

### å·²å®Œæˆ âœ…
- [x] æ³¨å†Œ Cloudflare è´¦å·ï¼ˆharry.zhang592802@gmail.comï¼‰
- [x] è·å– Cloudflare Account ID å’Œ API Token
- [x] æ³¨å†Œ Supabase è´¦å·ï¼ˆGitHub: ZhangHui88888ï¼‰
- [x] åˆ›å»º Supabase é¡¹ç›®ï¼ˆXKTRUCKï¼‰
- [x] æ³¨å†Œ Resend è´¦å·ï¼Œè·å– API Key
- [x] æ³¨å†Œ DeepSeek è´¦å·ï¼Œè·å– API Key
- [x] è´­ä¹°åŸŸå xk-truck.cnï¼ˆé˜¿é‡Œäº‘ï¼‰
- [x] åŸŸåæ¥å…¥ Cloudflare DNSï¼ˆå·²æ¿€æ´»ï¼‰
- [x] æ³¨å†Œ Google Search Consoleï¼ˆå·²éªŒè¯ï¼‰

### å¾…å®Œæˆ â³
- [ ] éƒ¨ç½²å‰ç«¯åˆ° Cloudflare Pages
- [ ] éƒ¨ç½²åç«¯åˆ° Cloudflare Workers
- [ ] åˆ›å»º Cloudflare R2 å­˜å‚¨æ¡¶
- [ ] ä¸Šä¼ äº§å“å›¾ç‰‡åˆ° R2
- [ ] åˆ›å»º Supabase æ•°æ®åº“è¡¨
- [ ] å¯¼å…¥çŸ¥è¯†åº“åˆ° Supabase
- [ ] é…ç½®é‚®ä»¶é€šçŸ¥
- [ ] æäº¤ sitemap.xml åˆ° GSC

### æš‚åœ â¸ï¸
- [ ] æ³¨å†Œ Meta Business è´¦å·ï¼ˆéœ€æµ·å¤–æ‰‹æœºéªŒè¯ï¼‰
- [ ] ç”³è¯· WhatsApp Business API
- [ ] é…ç½® WhatsApp Webhook
- [ ] éƒ¨ç½² WhatsApp AI å›å¤ Worker

---

## SEO + GEO ä¼˜åŒ–ç­–ç•¥

> **SEO** = Search Engine Optimizationï¼ˆä¼ ç»Ÿæœç´¢å¼•æ“ä¼˜åŒ–ï¼‰  
> **GEO** = Generative Engine Optimizationï¼ˆAI æœç´¢å¼•æ“ä¼˜åŒ–ï¼‰

### SEO vs GEO å¯¹æ¯”

| å¯¹æ¯”é¡¹ | SEO | GEO |
|--------|-----|-----|
| ç›®æ ‡å¹³å° | Googleã€Bing | ChatGPTã€Perplexityã€Google AI Overview |
| ä¼˜åŒ–ç›®æ ‡ | æœç´¢æ’åé å‰ | è¢« AI å›ç­”å¼•ç”¨ |
| å†…å®¹è¦æ±‚ | å…³é”®è¯ã€Meta æ ‡ç­¾ | ç»“æ„åŒ–ã€æƒå¨æ€§ã€å¯å¼•ç”¨ |
| æµé‡å½¢å¼ | ç‚¹å‡»æœç´¢ç»“æœ | AI å›ç­”ä¸­çš„å¼•ç”¨é“¾æ¥ |
| å½“å‰é‡è¦æ€§ | â­â­â­â­â­ ä¸»æµ | â­â­â­â­ å¿«é€Ÿå¢é•¿ |

---

## ä¸€ã€SEO ä¼˜åŒ–ç­–ç•¥

### 1. å‰ç«¯æ¡†æ¶é€‰æ‹©

æ¨èä½¿ç”¨æ”¯æŒ **SSGï¼ˆé™æ€ç«™ç‚¹ç”Ÿæˆï¼‰** çš„æ¡†æ¶ï¼Œç¡®ä¿æœç´¢å¼•æ“å¯å®Œæ•´çˆ¬å–ï¼š

| æ¡†æ¶ | ç‰¹ç‚¹ | æ¨èåº¦ |
|------|------|--------|
| **Astro** | é›¶JSé»˜è®¤ã€å†…å®¹ä¼˜å…ˆã€SEOæœ€ä½³ | â­â­â­â­â­ |
| Next.js (Static Export) | Reactç”Ÿæ€ã€åŠŸèƒ½ä¸°å¯Œ | â­â­â­â­ |
| Nuxt.js (Static) | Vueç”Ÿæ€ã€é…ç½®ç®€å• | â­â­â­â­ |

> âš ï¸ é¿å…çº¯ SPAï¼ˆå¦‚ Create React Appï¼‰ï¼Œæœç´¢å¼•æ“éš¾ä»¥çˆ¬å–åŠ¨æ€å†…å®¹

### 2. å¿…å¤‡ SEO æ–‡ä»¶

```
/public
â”œâ”€â”€ sitemap.xml      # ç½‘ç«™åœ°å›¾ï¼Œæäº¤ç»™ Google Search Console
â”œâ”€â”€ robots.txt       # çˆ¬è™«è§„åˆ™
â””â”€â”€ favicon.ico      # ç½‘ç«™å›¾æ ‡
```

**robots.txt ç¤ºä¾‹ï¼š**
```
User-agent: *
Allow: /
Sitemap: https://yourdomain.com/sitemap.xml
```

### 3. é¡µé¢ Meta æ ‡ç­¾

æ¯ä¸ªé¡µé¢éœ€åŒ…å«ï¼š

```html
<!-- åŸºç¡€ SEO -->
<title>Heavy Truck Parts Supplier | Your Brand</title>
<meta name="description" content="Professional heavy truck parts manufacturer...">
<link rel="canonical" href="https://yourdomain.com/products/xxx">

<!-- Open Graph (Facebook/LinkedIn) -->
<meta property="og:title" content="Product Name">
<meta property="og:description" content="Product description...">
<meta property="og:image" content="https://yourdomain.com/images/product.jpg">
<meta property="og:url" content="https://yourdomain.com/products/xxx">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
```

### 4. ç»“æ„åŒ–æ•°æ® (Schema.org)

äº§å“é¡µæ·»åŠ  JSON-LDï¼Œè®© Google å±•ç¤ºå¯Œæ–‡æœ¬ç»“æœï¼š

```html
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "Truck Air Filter",
  "image": "https://yourdomain.com/images/air-filter.jpg",
  "description": "High quality truck air filter...",
  "brand": {
    "@type": "Brand",
    "name": "Your Brand"
  },
  "offers": {
    "@type": "Offer",
    "priceCurrency": "USD",
    "price": "Contact for price",
    "availability": "https://schema.org/InStock"
  }
}
</script>
```

### 5. URL ç»“æ„è§„èŒƒ

```
âœ… æ¨èï¼š
/products/truck-air-filter-abc123
/category/engine-parts
/about

âŒ é¿å…ï¼š
/product?id=123
/p/abc123
```

### 6. å¤šè¯­è¨€ SEO (å¯é€‰)

å¦‚éœ€è¦†ç›–å¤šä¸ªå¸‚åœºï¼Œæ·»åŠ  hreflang æ ‡ç­¾ï¼š

```html
<link rel="alternate" hreflang="en" href="https://yourdomain.com/products/xxx">
<link rel="alternate" hreflang="es" href="https://yourdomain.com/es/products/xxx">
<link rel="alternate" hreflang="x-default" href="https://yourdomain.com/products/xxx">
```

### 7. æ€§èƒ½ä¼˜åŒ–ï¼ˆå·²è¦†ç›–ï¼‰

| ä¼˜åŒ–é¡¹ | çŠ¶æ€ |
|--------|------|
| CDN åŠ é€Ÿ | âœ… Cloudflare å…¨çƒèŠ‚ç‚¹ |
| å›¾ç‰‡ä¼˜åŒ– | âœ… R2 + CDN |
| HTTPS | âœ… Cloudflare è‡ªåŠ¨ SSL |
| ç§»åŠ¨ç«¯é€‚é… | éœ€å‰ç«¯å®ç°å“åº”å¼ |

### 8. SEO å·¥å…·é…ç½®

éƒ¨ç½²åéœ€é…ç½®ï¼š

- [ ] æ³¨å†Œ [Google Search Console](https://search.google.com/search-console)
- [ ] æäº¤ sitemap.xml
- [ ] æ³¨å†Œ [Bing Webmaster Tools](https://www.bing.com/webmasters)
- [ ] é…ç½® Google Analytics 4ï¼ˆå¯é€‰ï¼‰

### 9. åŠ¨æ€å…³é”®è¯æ›´æ–°æ–¹æ¡ˆ

SEO å…³é”®è¯éœ€è¦æŒç»­ä¼˜åŒ–ï¼Œä»¥ä¸‹æ˜¯ä½æˆæœ¬çš„åŠ¨æ€æ›´æ–°ç­–ç•¥ï¼š

#### æ•°æ®æ¥æº

| æ¥æº | ç”¨é€” | æˆæœ¬ |
|------|------|------|
| Google Search Console | æŸ¥çœ‹å®é™…æœç´¢è¯ã€ç‚¹å‡»ç‡ã€æ’å | å…è´¹ |
| Google Trends | è¶‹åŠ¿å˜åŒ–ã€å­£èŠ‚æ€§å…³é”®è¯ | å…è´¹ |
| å®¢æˆ·å¯¹è¯è®°å½• | æŒ–æ˜çœŸå®éœ€æ±‚è¯æ±‡ | å…è´¹ï¼ˆå·²æœ‰ï¼‰ |
| Ubersuggest | å…³é”®è¯å»ºè®®ã€ç«äº‰åˆ†æ | å…è´¹é¢åº¦ |
| Ahrefs/SEMrush | ä¸“ä¸šå…³é”®è¯å·¥å…· | ä»˜è´¹ï¼ˆå¯é€‰ï¼‰ |

#### è‡ªåŠ¨åŒ–æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å…³é”®è¯åŠ¨æ€æ›´æ–°æµç¨‹                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ æ•°æ®é‡‡é›†     â”‚ â†’  â”‚ AI åˆ†æ      â”‚ â†’  â”‚ å†…å®¹æ›´æ–°     â”‚
  â”‚              â”‚    â”‚              â”‚    â”‚              â”‚
  â”‚ â€¢ GSC API    â”‚    â”‚ â€¢ æå–é«˜æ½œè¯ â”‚    â”‚ â€¢ æ›´æ–° Meta  â”‚
  â”‚ â€¢ å¯¹è¯è®°å½•   â”‚    â”‚ â€¢ è¯†åˆ«è¶‹åŠ¿   â”‚    â”‚ â€¢ ä¼˜åŒ–æ ‡é¢˜   â”‚
  â”‚ â€¢ ç«å“ç›‘æ§   â”‚    â”‚ â€¢ ç”Ÿæˆå»ºè®®   â”‚    â”‚ â€¢ æ–°å¢å†…å®¹é¡µ â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘                                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœˆåº¦å¾ªç¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å®ç°æ–¹æ¡ˆï¼šåˆ©ç”¨ç°æœ‰æ¶æ„

**æ–¹æ¡ˆ Aï¼šæ‰‹åŠ¨ + AI è¾…åŠ©ï¼ˆæ¨èèµ·æ­¥ï¼‰**

1. **æ¯æœˆå¯¼å‡º GSC æ•°æ®**ï¼ˆæœç´¢è¯ã€ç‚¹å‡»ã€æ’åï¼‰
2. **AI åˆ†æç”Ÿæˆå»ºè®®**ï¼š
```javascript
// åœ¨ Worker ä¸­æ·»åŠ å…³é”®è¯åˆ†ææ¥å£
const prompt = `
åˆ†æä»¥ä¸‹æœç´¢æ•°æ®ï¼Œæ‰¾å‡ºï¼š
1. é«˜æ½œåŠ›å…³é”®è¯ï¼ˆé«˜å±•ç¤ºä½ç‚¹å‡»ï¼‰
2. éœ€è¦ä¼˜åŒ–çš„é¡µé¢
3. å»ºè®®æ–°å¢çš„å†…å®¹ä¸»é¢˜

æ•°æ®ï¼š${gscData}
`;
const suggestions = await callOpenAI(prompt);
```
3. **æ‰‹åŠ¨æ›´æ–°é¡µé¢ Meta å’Œå†…å®¹**

**æ–¹æ¡ˆ Bï¼šåŠè‡ªåŠ¨åŒ–ï¼ˆè¿›é˜¶ï¼‰**

```javascript
// Cloudflare Worker - å…³é”®è¯ç®¡ç† API
// å­˜å‚¨åœ¨ Supabase çš„ keywords è¡¨

// 1. å…³é”®è¯é…ç½®è¡¨ç»“æ„
/*
keywords è¡¨ï¼š
- id
- page_path        // é¡µé¢è·¯å¾„
- primary_keyword  // ä¸»å…³é”®è¯
- secondary_keywords // æ¬¡è¦å…³é”®è¯ (JSON)
- meta_title
- meta_description
- updated_at
*/

// 2. å‰ç«¯æ„å»ºæ—¶åŠ¨æ€è¯»å–
// astro.config.mjs æˆ– next.config.js
export async function getStaticProps({ params }) {
  const keywords = await fetch('https://api.yourdomain.com/keywords/' + params.slug);
  return {
    props: {
      seo: keywords
    }
  };
}
```

**æ–¹æ¡ˆ Cï¼šå…¨è‡ªåŠ¨åŒ–ï¼ˆå·²é€‰æ‹©ï¼‰** âœ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              GitHub Actions å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å‘¨ä¸€ 9:00ï¼‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. è°ƒç”¨ GSC API è·å–è¿‡å»7å¤©æœç´¢æ•°æ®                             â”‚
â”‚  2. è°ƒç”¨ AI åˆ†æç”Ÿæˆä¼˜åŒ–å»ºè®®                                     â”‚
â”‚  3. è‡ªåŠ¨æ›´æ–° Supabase å…³é”®è¯è¡¨                                   â”‚
â”‚  4. è§¦å‘ Cloudflare Pages é‡æ–°æ„å»º                               â”‚
â”‚  5. å‘é€æŠ¥å‘Šé‚®ä»¶ç»™ç«™é•¿                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**GitHub Actions å·¥ä½œæµé…ç½®ï¼š**

```yaml
# .github/workflows/seo-auto-update.yml
name: SEO Auto Update

on:
  schedule:
    - cron: '0 1 * * 1'  # æ¯å‘¨ä¸€ UTC 1:00 (åŒ—äº¬æ—¶é—´ 9:00)
  workflow_dispatch:      # æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  update-seo:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install googleapis @supabase/supabase-js openai resend

      - name: Run SEO Analysis
        env:
          GSC_CREDENTIALS: ${{ secrets.GSC_CREDENTIALS }}
          GSC_SITE_URL: ${{ secrets.GSC_SITE_URL }}
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}
          NOTIFY_EMAIL: ${{ secrets.NOTIFY_EMAIL }}
        run: node scripts/seo-auto-update.js

      - name: Trigger Cloudflare Pages Build
        run: |
          curl -X POST "https://api.cloudflare.com/client/v4/pages/webhooks/deploy_hooks/${{ secrets.CF_DEPLOY_HOOK }}"
```

**æ ¸å¿ƒè„šæœ¬å®ç°ï¼š**

```javascript
// scripts/seo-auto-update.js
const { google } = require('googleapis');
const { createClient } = require('@supabase/supabase-js');
const OpenAI = require('openai');
const { Resend } = require('resend');

// åˆå§‹åŒ–å®¢æˆ·ç«¯
const supabase = createClient(process.env.SUPABASE_URL, process.env.SUPABASE_KEY);
const openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });
const resend = new Resend(process.env.RESEND_API_KEY);

async function main() {
  console.log('ğŸš€ å¼€å§‹ SEO è‡ªåŠ¨æ›´æ–°...');

  // 1. è·å– GSC æ•°æ®
  const gscData = await fetchGSCData();
  console.log(`ğŸ“Š è·å–åˆ° ${gscData.length} æ¡æœç´¢æ•°æ®`);

  // 2. AI åˆ†æ
  const analysis = await analyzeWithAI(gscData);
  console.log('ğŸ¤– AI åˆ†æå®Œæˆ');

  // 3. æ›´æ–°æ•°æ®åº“
  const updates = await updateSupabase(analysis);
  console.log(`âœ… æ›´æ–°äº† ${updates.length} æ¡è®°å½•`);

  // 4. å‘é€æŠ¥å‘Šé‚®ä»¶
  await sendReport(analysis, updates);
  console.log('ğŸ“§ æŠ¥å‘Šå·²å‘é€');
}

// ========== 1. è·å– GSC æ•°æ® ==========
async function fetchGSCData() {
  const credentials = JSON.parse(process.env.GSC_CREDENTIALS);
  const auth = new google.auth.GoogleAuth({
    credentials,
    scopes: ['https://www.googleapis.com/auth/webmasters.readonly'],
  });

  const searchconsole = google.searchconsole({ version: 'v1', auth });

  const endDate = new Date().toISOString().split('T')[0];
  const startDate = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

  const response = await searchconsole.searchanalytics.query({
    siteUrl: process.env.GSC_SITE_URL,
    requestBody: {
      startDate,
      endDate,
      dimensions: ['query', 'page'],
      rowLimit: 500,
    },
  });

  return response.data.rows || [];
}

// ========== 2. AI åˆ†æ ==========
async function analyzeWithAI(gscData) {
  const prompt = `ä½ æ˜¯ä¸€ä¸ª SEO ä¸“å®¶ï¼Œåˆ†æä»¥ä¸‹ Google Search Console æ•°æ®ï¼Œè¿”å› JSON æ ¼å¼çš„ä¼˜åŒ–å»ºè®®ã€‚

æ•°æ®æ ¼å¼ï¼šæ¯è¡ŒåŒ…å« [æœç´¢è¯, é¡µé¢URL, ç‚¹å‡»æ•°, å±•ç¤ºæ•°, ç‚¹å‡»ç‡, å¹³å‡æ’å]

${JSON.stringify(gscData.slice(0, 100).map(row => ({
  query: row.keys[0],
  page: row.keys[1],
  clicks: row.clicks,
  impressions: row.impressions,
  ctr: (row.ctr * 100).toFixed(2) + '%',
  position: row.position.toFixed(1)
})), null, 2)}

è¯·åˆ†æå¹¶è¿”å›ä»¥ä¸‹ JSON ç»“æ„ï¼š
{
  "high_potential": [
    {
      "keyword": "å…³é”®è¯",
      "page": "é¡µé¢URL", 
      "reason": "é«˜å±•ç¤ºä½ç‚¹å‡»ï¼Œå»ºè®®ä¼˜åŒ–æ ‡é¢˜",
      "suggested_title": "å»ºè®®çš„æ–°æ ‡é¢˜",
      "suggested_description": "å»ºè®®çš„æ–°æè¿°"
    }
  ],
  "new_content_ideas": [
    {
      "keyword": "å…³é”®è¯",
      "reason": "ç”¨æˆ·æœç´¢ä½†æ— å¯¹åº”é¡µé¢",
      "suggested_page": "/suggested/url"
    }
  ],
  "summary": "æœ¬å‘¨ SEO æ¦‚å†µæ€»ç»“"
}

åªè¿”å› JSONï¼Œä¸è¦å…¶ä»–å†…å®¹ã€‚`;

  const response = await openai.chat.completions.create({
    model: 'gpt-4o-mini',
    messages: [{ role: 'user', content: prompt }],
    response_format: { type: 'json_object' },
  });

  return JSON.parse(response.choices[0].message.content);
}

// ========== 3. æ›´æ–° Supabase ==========
async function updateSupabase(analysis) {
  const updates = [];

  for (const item of analysis.high_potential || []) {
    const { error } = await supabase
      .from('page_seo')
      .upsert({
        page_path: new URL(item.page).pathname,
        title: item.suggested_title,
        description: item.suggested_description,
        keywords: [item.keyword],
        updated_at: new Date().toISOString(),
      }, { onConflict: 'page_path' });

    if (!error) {
      updates.push(item);
    }
  }

  return updates;
}

// ========== 4. å‘é€æŠ¥å‘Š ==========
async function sendReport(analysis, updates) {
  const html = `
    <h2>ğŸ“Š SEO å‘¨æŠ¥ - ${new Date().toLocaleDateString('zh-CN')}</h2>
    
    <h3>æ¦‚å†µ</h3>
    <p>${analysis.summary}</p>
    
    <h3>å·²è‡ªåŠ¨ä¼˜åŒ– (${updates.length} ä¸ªé¡µé¢)</h3>
    <ul>
      ${updates.map(u => `<li><strong>${u.keyword}</strong>: ${u.reason}</li>`).join('')}
    </ul>
    
    <h3>å»ºè®®æ–°å¢å†…å®¹</h3>
    <ul>
      ${(analysis.new_content_ideas || []).map(n => 
        `<li><strong>${n.keyword}</strong>: ${n.reason}</li>`
      ).join('')}
    </ul>
    
    <p style="color: #666; font-size: 12px;">æ­¤é‚®ä»¶ç”± GitHub Actions è‡ªåŠ¨å‘é€</p>
  `;

  await resend.emails.send({
    from: 'SEO Bot <seo@yourdomain.com>',
    to: process.env.NOTIFY_EMAIL,
    subject: `ğŸ“Š SEO å‘¨æŠ¥ - å·²ä¼˜åŒ– ${updates.length} ä¸ªé¡µé¢`,
    html,
  });
}

main().catch(console.error);
```

**éœ€è¦é…ç½®çš„ GitHub Secretsï¼š**

| Secret åç§° | è¯´æ˜ | è·å–æ–¹å¼ |
|-------------|------|----------|
| `GSC_CREDENTIALS` | Google Cloud æœåŠ¡è´¦å· JSON | [Google Cloud Console](https://console.cloud.google.com/) åˆ›å»ºæœåŠ¡è´¦å· |
| `GSC_SITE_URL` | ç½‘ç«™ URL | å¦‚ `https://yourdomain.com` |
| `SUPABASE_URL` | Supabase é¡¹ç›® URL | Supabase é¡¹ç›®è®¾ç½® |
| `SUPABASE_KEY` | Supabase service_role key | Supabase é¡¹ç›®è®¾ç½® > API |
| `OPENAI_API_KEY` | OpenAI API Key | [OpenAI Platform](https://platform.openai.com/) |
| `RESEND_API_KEY` | Resend API Key | [Resend Dashboard](https://resend.com/) |
| `NOTIFY_EMAIL` | æ¥æ”¶æŠ¥å‘Šçš„é‚®ç®± | ä½ çš„é‚®ç®± |
| `CF_DEPLOY_HOOK` | Cloudflare éƒ¨ç½²é’©å­ | Cloudflare Pages > è®¾ç½® > æ„å»ºé’©å­ |

**GSC API é…ç½®æ­¥éª¤ï¼š**

1. åœ¨ [Google Cloud Console](https://console.cloud.google.com/) åˆ›å»ºé¡¹ç›®
2. å¯ç”¨ **Search Console API**
3. åˆ›å»ºæœåŠ¡è´¦å·ï¼Œä¸‹è½½ JSON å¯†é’¥
4. åœ¨ [Google Search Console](https://search.google.com/search-console) æ·»åŠ è¯¥æœåŠ¡è´¦å·ä¸ºç”¨æˆ·ï¼ˆåªè¯»æƒé™ï¼‰
5. å°† JSON å¯†é’¥å†…å®¹å­˜å…¥ `GSC_CREDENTIALS` secret

#### å…³é”®è¯å­˜å‚¨ç»“æ„

åœ¨ Supabase ä¸­åˆ›å»ºå…³é”®è¯ç®¡ç†è¡¨ï¼š

```sql
-- é¡µé¢ SEO é…ç½®è¡¨
CREATE TABLE page_seo (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  page_path TEXT UNIQUE NOT NULL,
  title TEXT,
  description TEXT,
  keywords TEXT[],
  og_image TEXT,
  updated_at TIMESTAMP DEFAULT NOW()
);

-- å…³é”®è¯è¡¨ç°è¿½è¸ª
CREATE TABLE keyword_performance (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  keyword TEXT NOT NULL,
  impressions INT,
  clicks INT,
  position DECIMAL,
  recorded_at DATE,
  UNIQUE(keyword, recorded_at)
);
```

#### ä»å®¢æˆ·å¯¹è¯æŒ–æ˜å…³é”®è¯

åˆ©ç”¨å·²æœ‰çš„ AI å®¢æœå¯¹è¯è®°å½•ï¼š

```javascript
// å®šæœŸåˆ†æå¯¹è¯ï¼Œæå–é«˜é¢‘è¯æ±‡
const analyzeChats = async () => {
  const chats = await supabase.from('chat_logs').select('*');
  
  const prompt = `
  åˆ†æä»¥ä¸‹å®¢æˆ·å¯¹è¯ï¼Œæå–ï¼š
  1. é«˜é¢‘äº§å“è¯
  2. å®¢æˆ·å¸¸ç”¨çš„æœç´¢æ„å›¾è¯
  3. è¡Œä¸šæœ¯è¯­å’Œåˆ«å
  
  å¯¹è¯è®°å½•ï¼š${JSON.stringify(chats)}
  `;
  
  return await callOpenAI(prompt);
};
```

#### æ‰§è¡ŒèŠ‚å¥å»ºè®®

| é¢‘ç‡ | ä»»åŠ¡ |
|------|------|
| æ¯å‘¨ | æŸ¥çœ‹ GSC æ•°æ®ï¼Œå…³æ³¨å¼‚å¸¸å˜åŒ– |
| æ¯æœˆ | AI åˆ†æ + æ›´æ–°é‡ç‚¹é¡µé¢å…³é”®è¯ |
| æ¯å­£åº¦ | å…¨ç«™å…³é”®è¯å®¡è®¡ï¼Œè°ƒæ•´ç­–ç•¥ |
| æŒç»­ | ä»å®¢æˆ·å¯¹è¯ä¸­æŒ–æ˜æ–°è¯ |

---

## äºŒã€GEO ä¼˜åŒ–ç­–ç•¥

GEO (Generative Engine Optimization) é’ˆå¯¹ AI æœç´¢å¼•æ“ä¼˜åŒ–ï¼Œè®©ä½ çš„å†…å®¹è¢« ChatGPTã€Perplexityã€Google AI Overview ç­‰å¼•ç”¨ã€‚

### 1. AI çˆ¬è™«é…ç½®

åœ¨ `robots.txt` ä¸­å…è®¸ AI çˆ¬è™«è®¿é—®ï¼š

```
# robots.txt - å…è®¸ AI çˆ¬è™«
User-agent: *
Allow: /

# AI æœç´¢å¼•æ“çˆ¬è™«
User-agent: GPTBot
Allow: /

User-agent: ChatGPT-User
Allow: /

User-agent: PerplexityBot
Allow: /

User-agent: ClaudeBot
Allow: /

User-agent: Google-Extended
Allow: /

Sitemap: https://yourdomain.com/sitemap.xml
```

> âš ï¸ å¦‚æœä¸æƒ³è¢« AI è®­ç»ƒä½†æƒ³è¢«å¼•ç”¨ï¼Œå¯ä»¥è®¾ç½® `Disallow` ç‰¹å®šçˆ¬è™«

### 2. å†…å®¹ç»“æ„ä¼˜åŒ–

AI æ›´å®¹æ˜“ç†è§£å’Œå¼•ç”¨ç»“æ„åŒ–çš„å†…å®¹ï¼š

**äº§å“é¡µé¢æ¨¡æ¿ï¼š**

```markdown
# [äº§å“åç§°] - [æ ¸å¿ƒå–ç‚¹]

## äº§å“æ¦‚è¿°
[2-3å¥è¯æ¸…æ™°æè¿°äº§å“æ˜¯ä»€ä¹ˆã€ç”¨äºä»€ä¹ˆ]

## æ ¸å¿ƒè§„æ ¼
| å‚æ•° | æ•°å€¼ |
|------|------|
| å‹å· | XXX |
| æè´¨ | XXX |
| å°ºå¯¸ | XXX |

## é€‚ç”¨è½¦å‹
- å“ç‰ŒA: å‹å·1, å‹å·2
- å“ç‰ŒB: å‹å·3, å‹å·4

## äº§å“ä¼˜åŠ¿
1. **ä¼˜åŠ¿ä¸€**: å…·ä½“è¯´æ˜
2. **ä¼˜åŠ¿äºŒ**: å…·ä½“è¯´æ˜

## å¸¸è§é—®é¢˜
### Q: è¿™ä¸ªäº§å“çš„è´¨ä¿æœŸæ˜¯å¤šä¹…ï¼Ÿ
A: æˆ‘ä»¬æä¾›12ä¸ªæœˆè´¨ä¿...

### Q: æ”¯æŒå“ªäº›ä»˜æ¬¾æ–¹å¼ï¼Ÿ
A: æ”¯æŒT/Tã€L/Cã€PayPal...
```

### 3. å¢å¼º Schema.org ç»“æ„åŒ–æ•°æ®

**äº§å“é¡µ JSON-LDï¼ˆGEO å¢å¼ºç‰ˆï¼‰ï¼š**

```html
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "Heavy Duty Truck Air Filter AF25708",
  "description": "High-performance air filter for Volvo, Scania heavy trucks. OEM quality, 12-month warranty.",
  "image": [
    "https://yourdomain.com/images/af25708-1.jpg",
    "https://yourdomain.com/images/af25708-2.jpg"
  ],
  "sku": "AF25708",
  "mpn": "AF25708",
  "brand": {
    "@type": "Brand",
    "name": "Your Brand"
  },
  "manufacturer": {
    "@type": "Organization",
    "name": "Your Company Name",
    "url": "https://yourdomain.com",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "CN",
      "addressRegion": "Guangdong"
    }
  },
  "offers": {
    "@type": "Offer",
    "priceCurrency": "USD",
    "price": "Contact for price",
    "availability": "https://schema.org/InStock",
    "priceValidUntil": "2025-12-31"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.8",
    "reviewCount": "156"
  },
  "review": [
    {
      "@type": "Review",
      "author": "John D.",
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "5"
      },
      "reviewBody": "Excellent quality, fast shipping to Germany."
    }
  ]
}
</script>
```

**å…¬å¸é¡µ JSON-LDï¼š**

```html
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Your Company Name",
  "url": "https://yourdomain.com",
  "logo": "https://yourdomain.com/logo.png",
  "description": "Professional heavy truck parts manufacturer and exporter since 2010. Serving 50+ countries.",
  "foundingDate": "2010",
  "numberOfEmployees": {
    "@type": "QuantitativeValue",
    "value": "200+"
  },
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "Your Address",
    "addressLocality": "Guangzhou",
    "addressRegion": "Guangdong",
    "postalCode": "510000",
    "addressCountry": "CN"
  },
  "contactPoint": {
    "@type": "ContactPoint",
    "telephone": "+86-xxx-xxxx",
    "contactType": "sales",
    "availableLanguage": ["English", "Chinese"]
  },
  "sameAs": [
    "https://www.linkedin.com/company/yourcompany",
    "https://www.facebook.com/yourcompany"
  ]
}
</script>
```

**FAQ é¡µ JSON-LDï¼š**

```html
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "What is the minimum order quantity?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Our MOQ varies by product. For air filters, the MOQ is 100 pieces. For smaller items, we accept mixed orders of $500 minimum."
      }
    },
    {
      "@type": "Question",
      "name": "Do you offer OEM/ODM services?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes, we provide full OEM/ODM services including custom packaging, logo printing, and product modifications."
      }
    },
    {
      "@type": "Question",
      "name": "What are your payment terms?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "We accept T/T (30% deposit, 70% before shipment), L/C at sight, and PayPal for small orders."
      }
    }
  ]
}
</script>
```

### 4. æƒå¨æ€§ä¿¡å·

AI æ›´å€¾å‘å¼•ç”¨æœ‰æƒå¨æ€§çš„å†…å®¹ï¼š

| ä¿¡å·ç±»å‹ | å®ç°æ–¹å¼ |
|----------|----------|
| **æ•°æ®æ”¯æ’‘** | "å‡ºå£50+å›½å®¶"ã€"å¹´äº§100ä¸‡ä»¶" |
| **è®¤è¯å±•ç¤º** | ISO9001ã€CEã€DOT è®¤è¯å›¾æ ‡ |
| **å®¢æˆ·æ¡ˆä¾‹** | çŸ¥åå®¢æˆ· logoï¼ˆéœ€æˆæƒï¼‰ |
| **è¡Œä¸šå¼•ç”¨** | å¼•ç”¨è¡Œä¸šæ ‡å‡†ã€æŠ€æœ¯è§„èŒƒ |
| **æ›´æ–°æ—¶é—´** | æ˜¾ç¤º"æœ€åæ›´æ–°: 2024-12"ï¼Œè¡¨æ˜å†…å®¹æ–°é²œ |

**ç¤ºä¾‹ï¼š**
```html
<p>
  Founded in 2010, we have exported to <strong>50+ countries</strong> 
  with annual production capacity of <strong>1 million units</strong>.
  All products are <strong>ISO9001:2015 certified</strong>.
</p>
<p class="text-gray-500 text-sm">Last updated: December 2024</p>
```

### 5. å¯å¼•ç”¨å†…å®¹è®¾è®¡

è®© AI å®¹æ˜“æå–å’Œå¼•ç”¨çš„å†…å®¹æ ¼å¼ï¼š

```html
<!-- å¯å¼•ç”¨çš„å…³é”®ä¿¡æ¯å— -->
<blockquote class="key-info">
  <strong>Quick Facts:</strong>
  <ul>
    <li>MOQ: 100 pieces</li>
    <li>Lead time: 15-20 days</li>
    <li>Warranty: 12 months</li>
    <li>Shipping: FOB Guangzhou</li>
  </ul>
</blockquote>
```

### 6. GEO ç›‘æ§æ–¹æ¡ˆ

è¿½è¸ª AI æœç´¢å¼•æ“çš„å¼•ç”¨æƒ…å†µï¼š

**æ–¹æ³• Aï¼šæ‰‹åŠ¨ç›‘æ§**
- å®šæœŸåœ¨ ChatGPTã€Perplexity æœç´¢ä½ çš„äº§å“å…³é”®è¯
- æ£€æŸ¥æ˜¯å¦è¢«å¼•ç”¨ï¼Œå¼•ç”¨å†…å®¹æ˜¯å¦å‡†ç¡®

**æ–¹æ³• Bï¼šæ—¥å¿—åˆ†æ**

åœ¨ Cloudflare Worker ä¸­è®°å½• AI çˆ¬è™«è®¿é—®ï¼š

```javascript
// åœ¨ Worker ä¸­æ·»åŠ  AI çˆ¬è™«æ—¥å¿—
const AI_BOTS = ['GPTBot', 'ChatGPT-User', 'PerplexityBot', 'ClaudeBot'];

export default {
  async fetch(request, env) {
    const userAgent = request.headers.get('user-agent') || '';
    
    // æ£€æµ‹ AI çˆ¬è™«
    const isAIBot = AI_BOTS.some(bot => userAgent.includes(bot));
    
    if (isAIBot) {
      // è®°å½•åˆ° Supabase
      await env.SUPABASE.from('ai_bot_visits').insert({
        bot: userAgent,
        path: new URL(request.url).pathname,
        timestamp: new Date().toISOString()
      });
    }
    
    // ç»§ç»­æ­£å¸¸å¤„ç†è¯·æ±‚...
  }
};
```

**Supabase è¡¨ç»“æ„ï¼š**

```sql
CREATE TABLE ai_bot_visits (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  bot TEXT,
  path TEXT,
  timestamp TIMESTAMPTZ DEFAULT NOW()
);

-- æŸ¥è¯¢ç»Ÿè®¡
SELECT 
  DATE(timestamp) as date,
  bot,
  COUNT(*) as visits
FROM ai_bot_visits
GROUP BY DATE(timestamp), bot
ORDER BY date DESC;
```

### 7. GEO ä¼˜åŒ–æ¸…å•

- [ ] é…ç½® robots.txt å…è®¸ AI çˆ¬è™«
- [ ] äº§å“é¡µæ·»åŠ å®Œæ•´ Schema.org ç»“æ„åŒ–æ•°æ®
- [ ] å…¬å¸ä»‹ç»é¡µæ·»åŠ  Organization Schema
- [ ] FAQ é¡µæ·»åŠ  FAQPage Schema
- [ ] å†…å®¹ä½¿ç”¨æ¸…æ™°çš„æ ‡é¢˜å±‚çº§ï¼ˆH1-H3ï¼‰
- [ ] æ·»åŠ æƒå¨æ€§ä¿¡å·ï¼ˆè®¤è¯ã€æ•°æ®ã€æ¡ˆä¾‹ï¼‰
- [ ] è®¾ç½® AI çˆ¬è™«è®¿é—®æ—¥å¿—ç›‘æ§
- [ ] å®šæœŸæ‰‹åŠ¨æ£€æŸ¥ AI æœç´¢å¼•ç”¨æƒ…å†µ

---

## ä¸‰ã€äº§å“æ•°æ®åŒæ­¥åŠŸèƒ½

ä»ç°æœ‰ç½‘ç«™ (xklamp.com) åŒæ­¥äº§å“æ•°æ®åˆ°ç‹¬ç«‹ç«™ï¼Œæ”¯æŒä¸€é”®åŒæ­¥ã€‚

### 1. åŠŸèƒ½æ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      äº§å“åŒæ­¥æµç¨‹                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ æºç«™çˆ¬å–     â”‚ â†’  â”‚ æ•°æ®å¤„ç†     â”‚ â†’  â”‚ å­˜å‚¨å‘å¸ƒ     â”‚
  â”‚              â”‚    â”‚              â”‚    â”‚              â”‚
  â”‚ â€¢ äº§å“åˆ—è¡¨   â”‚    â”‚ â€¢ å›¾ç‰‡ä¸‹è½½   â”‚    â”‚ â€¢ å›¾ç‰‡â†’R2    â”‚
  â”‚ â€¢ äº§å“è¯¦æƒ…   â”‚    â”‚ â€¢ æ•°æ®æ¸…æ´—   â”‚    â”‚ â€¢ æ•°æ®â†’Supabase â”‚
  â”‚ â€¢ å›¾ç‰‡URL    â”‚    â”‚ â€¢ æ ¼å¼è½¬æ¢   â”‚    â”‚ â€¢ è§¦å‘é‡å»º   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ•°æ®ç»“æ„

**Supabase äº§å“è¡¨ï¼š**

```sql
CREATE TABLE products (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  sku TEXT UNIQUE NOT NULL,
  name TEXT NOT NULL,
  brand TEXT,
  description TEXT,
  compatible_models TEXT,
  oe_numbers TEXT[],
  images TEXT[],
  category TEXT,
  specifications JSONB,
  source_url TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- äº§å“åˆ†ç±»è¡¨
CREATE TABLE categories (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  slug TEXT UNIQUE NOT NULL,
  parent_id UUID REFERENCES categories(id),
  image TEXT
);

-- å“ç‰Œè¡¨
CREATE TABLE brands (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  slug TEXT UNIQUE NOT NULL,
  logo TEXT,
  description TEXT
);
```

### 3. åŒæ­¥è„šæœ¬

**å®‰è£…ä¾èµ–ï¼š**

```bash
npm install puppeteer @supabase/supabase-js @aws-sdk/client-s3 p-limit
```

**åŒæ­¥è„šæœ¬ (scripts/sync-products.js)ï¼š**

```javascript
// scripts/sync-products.js
const puppeteer = require('puppeteer');
const { createClient } = require('@supabase/supabase-js');
const { S3Client, PutObjectCommand } = require('@aws-sdk/client-s3');
const fs = require('fs');
const path = require('path');
const https = require('https');
const pLimit = require('p-limit');

// é…ç½®
const SOURCE_SITE = 'https://xklamp.com';
const BRANDS = ['volvo', 'benz', 'scania', 'daf', 'iveco', 'man', 'renault', 'ford'];

// åˆå§‹åŒ–å®¢æˆ·ç«¯
const supabase = createClient(
  process.env.SUPABASE_URL,
  process.env.SUPABASE_KEY
);

const r2 = new S3Client({
  region: 'auto',
  endpoint: process.env.R2_ENDPOINT,
  credentials: {
    accessKeyId: process.env.R2_ACCESS_KEY,
    secretAccessKey: process.env.R2_SECRET_KEY,
  },
});

// å¹¶å‘é™åˆ¶
const limit = pLimit(5);

// ========== ä¸»å‡½æ•° ==========
async function syncProducts() {
  console.log('ğŸš€ å¼€å§‹äº§å“åŒæ­¥...');
  
  const browser = await puppeteer.launch({ headless: 'new' });
  const page = await browser.newPage();
  
  let totalProducts = 0;
  
  for (const brand of BRANDS) {
    console.log(`\nğŸ“¦ åŒæ­¥å“ç‰Œ: ${brand.toUpperCase()}`);
    const products = await scrapeBrandProducts(page, brand);
    
    for (const product of products) {
      await limit(async () => {
        try {
          // 1. è·å–äº§å“è¯¦æƒ…
          const details = await scrapeProductDetails(page, product.url);
          
          // 2. ä¸‹è½½å¹¶ä¸Šä¼ å›¾ç‰‡åˆ° R2
          const images = await uploadImages(details.images, product.sku);
          
          // 3. ä¿å­˜åˆ° Supabase
          await saveProduct({
            ...product,
            ...details,
            images,
          });
          
          totalProducts++;
          console.log(`  âœ… ${product.sku} - ${product.name}`);
        } catch (error) {
          console.error(`  âŒ ${product.sku} å¤±è´¥:`, error.message);
        }
      });
    }
  }
  
  await browser.close();
  console.log(`\nğŸ‰ åŒæ­¥å®Œæˆ! å…± ${totalProducts} ä¸ªäº§å“`);
}

// ========== çˆ¬å–å“ç‰Œäº§å“åˆ—è¡¨ ==========
async function scrapeBrandProducts(page, brand) {
  const url = `${SOURCE_SITE}/collections/${brand}`;
  await page.goto(url, { waitUntil: 'networkidle2' });
  
  const products = await page.evaluate(() => {
    const items = document.querySelectorAll('.product-card, .product-item, [data-product]');
    return Array.from(items).map(item => {
      const link = item.querySelector('a');
      const title = item.querySelector('.product-title, h3, h2')?.textContent?.trim();
      const sku = title?.match(/^\d+/)?.[0] || '';
      
      return {
        name: title,
        sku: sku,
        url: link?.href,
      };
    }).filter(p => p.url && p.sku);
  });
  
  console.log(`  æ‰¾åˆ° ${products.length} ä¸ªäº§å“`);
  return products;
}

// ========== çˆ¬å–äº§å“è¯¦æƒ… ==========
async function scrapeProductDetails(page, url) {
  await page.goto(url, { waitUntil: 'networkidle2' });
  
  const details = await page.evaluate(() => {
    // è·å–å›¾ç‰‡
    const images = Array.from(document.querySelectorAll(
      '.product-image img, .product-gallery img, [data-product-image]'
    )).map(img => img.src || img.dataset.src).filter(Boolean);
    
    // è·å–æè¿°
    const description = document.querySelector(
      '.product-description, .description, [data-product-description]'
    )?.innerHTML || '';
    
    // è·å–è§„æ ¼
    const specs = {};
    document.querySelectorAll('.product-specs tr, .specifications tr').forEach(row => {
      const key = row.querySelector('th, td:first-child')?.textContent?.trim();
      const value = row.querySelector('td:last-child')?.textContent?.trim();
      if (key && value) specs[key] = value;
    });
    
    // è·å– OE ç¼–å·
    const oeText = document.body.innerText;
    const oeNumbers = oeText.match(/\b\d{8}\b/g) || [];
    
    // è·å–é€‚é…è½¦å‹
    const compatible = document.querySelector(
      '.compatible-models, .fitment'
    )?.textContent?.trim() || '';
    
    return {
      images: [...new Set(images)],
      description,
      specifications: specs,
      oe_numbers: [...new Set(oeNumbers)],
      compatible_models: compatible,
    };
  });
  
  return details;
}

// ========== ä¸Šä¼ å›¾ç‰‡åˆ° R2 ==========
async function uploadImages(imageUrls, sku) {
  const uploadedUrls = [];
  
  for (let i = 0; i < imageUrls.length; i++) {
    const imageUrl = imageUrls[i];
    const ext = path.extname(new URL(imageUrl).pathname) || '.jpg';
    const key = `products/${sku}/${sku}_${i + 1}${ext}`;
    
    try {
      // ä¸‹è½½å›¾ç‰‡
      const imageBuffer = await downloadImage(imageUrl);
      
      // ä¸Šä¼ åˆ° R2
      await r2.send(new PutObjectCommand({
        Bucket: process.env.R2_BUCKET,
        Key: key,
        Body: imageBuffer,
        ContentType: `image/${ext.slice(1)}`,
      }));
      
      uploadedUrls.push(`${process.env.R2_PUBLIC_URL}/${key}`);
    } catch (error) {
      console.error(`    å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ${imageUrl}`, error.message);
    }
  }
  
  return uploadedUrls;
}

// ========== ä¸‹è½½å›¾ç‰‡ ==========
function downloadImage(url) {
  return new Promise((resolve, reject) => {
    https.get(url, (response) => {
      const chunks = [];
      response.on('data', chunk => chunks.push(chunk));
      response.on('end', () => resolve(Buffer.concat(chunks)));
      response.on('error', reject);
    }).on('error', reject);
  });
}

// ========== ä¿å­˜åˆ° Supabase ==========
async function saveProduct(product) {
  const { error } = await supabase
    .from('products')
    .upsert({
      sku: product.sku,
      name: product.name,
      brand: product.brand,
      description: product.description,
      compatible_models: product.compatible_models,
      oe_numbers: product.oe_numbers,
      images: product.images,
      specifications: product.specifications,
      source_url: product.url,
      updated_at: new Date().toISOString(),
    }, { onConflict: 'sku' });
  
  if (error) throw error;
}

// è¿è¡Œ
syncProducts().catch(console.error);
```

### 4. ç®¡ç†åå°åŒæ­¥æŒ‰é’®

> âš ï¸ **æ³¨æ„**ï¼šåŒæ­¥æŒ‰é’®åœ¨**ç®¡ç†åå°**ï¼Œä¸æ˜¯å®¢æˆ·è®¿é—®çš„å‰å°é¡µé¢ã€‚
> 
> - **å‰å°** (xk-truck.cn)ï¼šå®¢æˆ·è®¿é—®ï¼Œå±•ç¤ºäº§å“ã€AIå®¢æœã€è¯¢ç›˜è¡¨å•
> - **åå°** (xk-truck.cn/admin)ï¼šç®¡ç†å‘˜ç™»å½•åè®¿é—®ï¼Œäº§å“åŒæ­¥ã€æ•°æ®ç®¡ç†

**åå°é¡µé¢ç»“æ„ï¼š**
```
/admin              â†’ ç™»å½•é¡µ
/admin/dashboard    â†’ ä»ªè¡¨ç›˜ï¼ˆè¯¢ç›˜ç»Ÿè®¡ã€è®¿é—®é‡ï¼‰
/admin/products     â†’ äº§å“ç®¡ç† + åŒæ­¥æŒ‰é’®
/admin/inquiries    â†’ è¯¢ç›˜åˆ—è¡¨
/admin/settings     â†’ ç³»ç»Ÿè®¾ç½®
```

**å‰ç«¯ç»„ä»¶ (React/Astro)ï¼š**

```jsx
// components/SyncButton.jsx
import { useState } from 'react';

export default function SyncButton() {
  const [syncing, setSyncing] = useState(false);
  const [result, setResult] = useState(null);

  const handleSync = async () => {
    if (!confirm('ç¡®å®šè¦åŒæ­¥äº§å“æ•°æ®å—ï¼Ÿè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ã€‚')) return;
    
    setSyncing(true);
    setResult(null);
    
    try {
      const response = await fetch('/api/sync-products', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('admin_token')}`,
        },
      });
      
      const data = await response.json();
      setResult(data);
    } catch (error) {
      setResult({ success: false, message: error.message });
    } finally {
      setSyncing(false);
    }
  };

  return (
    <div className="p-4 border rounded-lg">
      <h3 className="text-lg font-bold mb-2">äº§å“æ•°æ®åŒæ­¥</h3>
      <p className="text-gray-600 mb-4">
        ä» xklamp.com åŒæ­¥æœ€æ–°äº§å“æ•°æ®å’Œå›¾ç‰‡
      </p>
      
      <button
        onClick={handleSync}
        disabled={syncing}
        className={`px-4 py-2 rounded text-white ${
          syncing ? 'bg-gray-400' : 'bg-blue-600 hover:bg-blue-700'
        }`}
      >
        {syncing ? (
          <>
            <span className="animate-spin mr-2">â³</span>
            åŒæ­¥ä¸­...
          </>
        ) : (
          'ğŸ”„ ä¸€é”®åŒæ­¥äº§å“'
        )}
      </button>
      
      {result && (
        <div className={`mt-4 p-3 rounded ${
          result.success ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
        }`}>
          {result.success ? (
            <>âœ… åŒæ­¥æˆåŠŸï¼å…±æ›´æ–° {result.count} ä¸ªäº§å“</>
          ) : (
            <>âŒ åŒæ­¥å¤±è´¥ï¼š{result.message}</>
          )}
        </div>
      )}
    </div>
  );
}
```

### 5. åŒæ­¥ API (Cloudflare Worker)

```javascript
// workers/sync-api.js
export default {
  async fetch(request, env) {
    // éªŒè¯ç®¡ç†å‘˜æƒé™
    const authHeader = request.headers.get('Authorization');
    if (!authHeader || !verifyAdminToken(authHeader, env.ADMIN_SECRET)) {
      return new Response('Unauthorized', { status: 401 });
    }
    
    if (request.method === 'POST' && new URL(request.url).pathname === '/api/sync-products') {
      try {
        // è§¦å‘ GitHub Actions å·¥ä½œæµ
        const response = await fetch(
          `https://api.github.com/repos/${env.GITHUB_REPO}/actions/workflows/sync-products.yml/dispatches`,
          {
            method: 'POST',
            headers: {
              'Authorization': `token ${env.GITHUB_TOKEN}`,
              'Accept': 'application/vnd.github.v3+json',
            },
            body: JSON.stringify({ ref: 'main' }),
          }
        );
        
        if (response.ok) {
          return Response.json({ 
            success: true, 
            message: 'åŒæ­¥ä»»åŠ¡å·²å¯åŠ¨ï¼Œè¯·ç¨åæŸ¥çœ‹ç»“æœ' 
          });
        } else {
          throw new Error('Failed to trigger sync');
        }
      } catch (error) {
        return Response.json({ 
          success: false, 
          message: error.message 
        }, { status: 500 });
      }
    }
    
    return new Response('Not Found', { status: 404 });
  }
};

function verifyAdminToken(header, secret) {
  const token = header.replace('Bearer ', '');
  return token === secret;
}
```

### 6. GitHub Actions å·¥ä½œæµ

```yaml
# .github/workflows/sync-products.yml
name: Sync Products

on:
  workflow_dispatch:  # æ”¯æŒæ‰‹åŠ¨/APIè§¦å‘
  schedule:
    - cron: '0 2 * * 0'  # æ¯å‘¨æ—¥ UTC 2:00 è‡ªåŠ¨åŒæ­¥

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install dependencies
        run: npm install puppeteer @supabase/supabase-js @aws-sdk/client-s3 p-limit
      
      - name: Run sync script
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          R2_ENDPOINT: ${{ secrets.R2_ENDPOINT }}
          R2_ACCESS_KEY: ${{ secrets.R2_ACCESS_KEY }}
          R2_SECRET_KEY: ${{ secrets.R2_SECRET_KEY }}
          R2_BUCKET: ${{ secrets.R2_BUCKET }}
          R2_PUBLIC_URL: ${{ secrets.R2_PUBLIC_URL }}
        run: node scripts/sync-products.js
      
      - name: Trigger site rebuild
        run: |
          curl -X POST "${{ secrets.CF_DEPLOY_HOOK }}"
```

### 7. éœ€è¦é…ç½®çš„ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | è·å–æ–¹å¼ |
|--------|------|----------|
| `SUPABASE_URL` | Supabase é¡¹ç›® URL | å·²æœ‰ |
| `SUPABASE_KEY` | Supabase service_role key | å·²æœ‰ |
| `R2_ENDPOINT` | R2 ç«¯ç‚¹ | Cloudflare R2 è®¾ç½® |
| `R2_ACCESS_KEY` | R2 è®¿é—®å¯†é’¥ | Cloudflare R2 API Token |
| `R2_SECRET_KEY` | R2 å¯†é’¥ | Cloudflare R2 API Token |
| `R2_BUCKET` | R2 å­˜å‚¨æ¡¶å | å¦‚ `xktruck-images` |
| `R2_PUBLIC_URL` | R2 å…¬å¼€è®¿é—® URL | å¦‚ `https://images.xk-truck.cn` |
| `GITHUB_REPO` | GitHub ä»“åº“ | å¦‚ `username/repo` |
| `GITHUB_TOKEN` | GitHub Personal Access Token | GitHub Settings |
| `ADMIN_SECRET` | ç®¡ç†å‘˜å¯†é’¥ | è‡ªå®šä¹‰å¼ºå¯†ç  |

### 8. åŒæ­¥åŠŸèƒ½æ¸…å•

- [ ] åˆ›å»º Supabase äº§å“ç›¸å…³è¡¨
- [ ] åˆ›å»º Cloudflare R2 å­˜å‚¨æ¡¶
- [ ] é…ç½® R2 å…¬å¼€è®¿é—®åŸŸå
- [ ] ç¼–å†™åŒæ­¥è„šæœ¬
- [ ] é…ç½® GitHub Actions
- [ ] å®ç°ç®¡ç†åå°åŒæ­¥æŒ‰é’®
- [ ] æµ‹è¯•å®Œæ•´åŒæ­¥æµç¨‹

---

## æ€»ç»“

æ­¤æ–¹æ¡ˆé€‚åˆï¼š
- å°å‹å¤–è´¸ç‹¬ç«‹ç«™
- äº§å“å±•ç¤º + æ™ºèƒ½å®¢æœ
- é¢„ç®—æœ‰é™ï¼Œè¿½æ±‚æ€§ä»·æ¯”
- æ— éœ€å¤„ç†æ•æ„Ÿå•†ä¸šæ•°æ®

æ ¸å¿ƒä¼˜åŠ¿ï¼š
- **å‡ ä¹é›¶æˆæœ¬**ï¼ˆä»…å¤§æ¨¡å‹APIæŒ‰é‡ä»˜è´¹ï¼‰
- **é›¶è¿ç»´**ï¼ˆå…¨æ‰˜ç®¡æœåŠ¡ï¼‰
- **å…¨çƒåŠ é€Ÿ**ï¼ˆCloudflareè¾¹ç¼˜ç½‘ç»œï¼‰
- **å¼¹æ€§æ‰©å±•**ï¼ˆæµé‡å¢é•¿æ— éœ€æ”¹æ¶æ„ï¼‰
