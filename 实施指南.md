# XKTRUCK é¡¹ç›®å®æ–½æŒ‡å—

æœ¬æ–‡æ¡£è®°å½•é¡¹ç›®çš„**å…·ä½“æ“ä½œæ­¥éª¤**ï¼Œæ¯ä¸€æ­¥éƒ½è¯´æ˜**åšä»€ä¹ˆã€æ€ä¹ˆåšã€ä¸ºä»€ä¹ˆè¿™æ ·åš**ã€‚

---

## ä¸€ã€æ·»åŠ åšå®¢æ–‡ç« 

### åšä»€ä¹ˆ
åœ¨ç½‘ç«™ä¸Šå‘å¸ƒä¸€ç¯‡æ–°çš„åšå®¢æ–‡ç« ã€‚

### æ€ä¹ˆåš

**ç¬¬ 1 æ­¥**ï¼šåœ¨ `xk-truck-frontend/src/content/blog/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„ `.md` æ–‡ä»¶

```bash
# æ–‡ä»¶åç”¨è‹±æ–‡ï¼Œç”¨çŸ­æ¨ªçº¿åˆ†éš”å•è¯
# ä¾‹å¦‚ï¼šhow-to-choose-truck-mirrors.md
```

**ç¬¬ 2 æ­¥**ï¼šåœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ å…ƒæ•°æ®ï¼ˆfrontmatterï¼‰

```markdown
---
title: "How to Choose Truck Mirrors"
description: "A complete guide to selecting the right mirrors for your heavy truck"
pubDate: 2025-12-12
author: "XKTRUCK Team"
tags: ["mirrors", "guide", "truck-parts"]
featured: false
---
```

| å­—æ®µ | è¯´æ˜ | å¿…å¡« |
|------|------|------|
| title | æ–‡ç« æ ‡é¢˜ï¼Œæ˜¾ç¤ºåœ¨é¡µé¢å’Œæœç´¢ç»“æœ | âœ… |
| description | æ–‡ç« æè¿°ï¼Œç”¨äº SEO å’Œåˆ—è¡¨é¢„è§ˆ | âœ… |
| pubDate | å‘å¸ƒæ—¥æœŸï¼Œæ ¼å¼ YYYY-MM-DD | âœ… |
| author | ä½œè€…åç§° | âœ… |
| tags | æ ‡ç­¾æ•°ç»„ï¼Œç”¨äºåˆ†ç±» | âœ… |
| featured | æ˜¯å¦ä¸ºç²¾é€‰æ–‡ç« ï¼Œæ˜¾ç¤ºåœ¨é¦–é¡µ | âŒ |

**ç¬¬ 3 æ­¥**ï¼šåœ¨ `---` ä¸‹æ–¹å†™æ–‡ç« æ­£æ–‡ï¼ˆMarkdown æ ¼å¼ï¼‰

```markdown
## Introduction

Your article content here...

## Section 1

More content...
```

**ç¬¬ 4 æ­¥**ï¼šæäº¤å¹¶æ¨é€

```bash
git add -A
git commit -m "blog: add article about truck mirrors"
git push
```

æ¨é€å Cloudflare Pages ä¼šè‡ªåŠ¨éƒ¨ç½²ï¼Œçº¦ 1-2 åˆ†é’Ÿåæ–‡ç« ä¸Šçº¿ã€‚

### ä¸ºä»€ä¹ˆè¿™æ ·åš
- **Markdown æ ¼å¼**ï¼šä¾¿äºç¼–å†™ï¼Œæ”¯æŒç‰ˆæœ¬æ§åˆ¶
- **frontmatter å…ƒæ•°æ®**ï¼šAstro è‡ªåŠ¨è¯»å–ç”Ÿæˆé¡µé¢å’Œ SEO ä¿¡æ¯
- **Git æ¨é€è‡ªåŠ¨éƒ¨ç½²**ï¼šæ— éœ€æ‰‹åŠ¨æ“ä½œï¼Œå‡å°‘å‡ºé”™

---

## äºŒã€éƒ¨ç½² Workerï¼ˆåç«¯ APIï¼‰

### åšä»€ä¹ˆ
å°†åç«¯ä»£ç æ›´æ–°åˆ° Cloudflare æœåŠ¡å™¨ã€‚

### æ€ä¹ˆåš

**ç¬¬ 1 æ­¥**ï¼šæ‰“å¼€ç»ˆç«¯ï¼Œè¿›å…¥ Worker ç›®å½•

```bash
cd d:\github\funNovels\TruckB2B\xk-truck-worker
```

**ç¬¬ 2 æ­¥**ï¼šæ‰§è¡Œéƒ¨ç½²å‘½ä»¤

```bash
wrangler deploy --env=""
```

**ç¬¬ 3 æ­¥**ï¼šç­‰å¾…éƒ¨ç½²å®Œæˆï¼Œçœ‹åˆ°ç±»ä¼¼è¾“å‡ºè¡¨ç¤ºæˆåŠŸ

```
Uploaded xk-truck-api (5.06 sec)
Deployed xk-truck-api triggers (2.01 sec)
  https://xk-truck-api.harry-zhang592802.workers.dev
```

### å¸¸è§é—®é¢˜

**é—®é¢˜ 1**ï¼šæç¤º `Multiple environments are defined`
```bash
# è§£å†³ï¼šåŠ ä¸Š --env="" å‚æ•°
wrangler deploy --env=""
```

**é—®é¢˜ 2**ï¼šæç¤º `fetch failed`
```bash
# åŸå› ï¼šç½‘ç»œä¸ç¨³å®š
# è§£å†³ï¼šé‡æ–°æ‰§è¡Œå‘½ä»¤
wrangler deploy --env=""
```

**é—®é¢˜ 3**ï¼šæç¤º `No matching export for import`
```bash
# åŸå› ï¼šä»£ç ä¸­å¯¼å…¥çš„å‡½æ•°åå’Œå¯¼å‡ºçš„ä¸ä¸€è‡´
# è§£å†³ï¼šæ£€æŸ¥ import è¯­å¥å’Œå¯¹åº”æ–‡ä»¶çš„ export è¯­å¥
```

### ä¸ºä»€ä¹ˆè¿™æ ·åš
- **`--env=""`**ï¼šä½¿ç”¨é»˜è®¤ç¯å¢ƒé…ç½®ï¼Œéƒ¨ç½²åˆ°åŸæœ‰çš„ Worker
- **ä¸ç”¨ `--env=production`**ï¼šä¼šåˆ›å»ºæ–°çš„ Workerï¼Œå¯¼è‡´ API åœ°å€å˜åŒ–
- **Worker ä¸è‡ªåŠ¨éƒ¨ç½²**ï¼šé¿å…ä»£ç æœ‰é—®é¢˜æ—¶å½±å“çº¿ä¸Š

---

## ä¸‰ã€æ·»åŠ  Worker å¯†é’¥

### åšä»€ä¹ˆ
é…ç½® API å¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ï¼Œä¸å†™å…¥ä»£ç ã€‚

### æ€ä¹ˆåš

**ç¬¬ 1 æ­¥**ï¼šè¿›å…¥ Worker ç›®å½•

```bash
cd d:\github\funNovels\TruckB2B\xk-truck-worker
```

**ç¬¬ 2 æ­¥**ï¼šæ‰§è¡Œæ·»åŠ å¯†é’¥å‘½ä»¤

```bash
wrangler secret put WHATSAPP_ACCESS_TOKEN
```

**ç¬¬ 3 æ­¥**ï¼šåœ¨æç¤ºåè¾“å…¥å¯†é’¥å€¼ï¼ˆä¸ä¼šæ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼‰

```
Enter a secret value: ********
```

**ç¬¬ 4 æ­¥**ï¼šçœ‹åˆ°æˆåŠŸæç¤º

```
ğŸŒ€ Creating the secret for the Worker "xk-truck-api"
âœ¨ Success! Uploaded secret WHATSAPP_ACCESS_TOKEN
```

### å½“å‰å·²é…ç½®çš„å¯†é’¥

| å¯†é’¥å | ç”¨é€” | çŠ¶æ€ |
|--------|------|------|
| SUPABASE_URL | æ•°æ®åº“åœ°å€ | âœ… å·²é…ç½® |
| SUPABASE_SERVICE_KEY | æ•°æ®åº“å¯†é’¥ | âœ… å·²é…ç½® |
| DEEPSEEK_API_KEY | AI æ¥å£å¯†é’¥ | âœ… å·²é…ç½® |
| RESEND_API_KEY | é‚®ä»¶æœåŠ¡å¯†é’¥ | âœ… å·²é…ç½® |
| NOTIFY_EMAIL | é€šçŸ¥é‚®ç®± | âœ… å·²é…ç½® |
| WHATSAPP_PHONE_NUMBER_ID | WhatsApp å·ç  ID | â³ å¾…é…ç½® |
| WHATSAPP_ACCESS_TOKEN | WhatsApp è®¿é—®ä»¤ç‰Œ | â³ å¾…é…ç½® |
| WHATSAPP_VERIFY_TOKEN | Webhook éªŒè¯ä»¤ç‰Œ | â³ å¾…é…ç½® |

### ä¸ºä»€ä¹ˆè¿™æ ·åš
- **ä¸å†™å…¥ä»£ç **ï¼šå¯†é’¥ä¸ä¼šå‡ºç°åœ¨ GitHubï¼Œé˜²æ­¢æ³„éœ²
- **Cloudflare å®‰å…¨å­˜å‚¨**ï¼šåŠ å¯†å­˜å‚¨ï¼Œåªæœ‰ Worker è¿è¡Œæ—¶èƒ½è¯»å–
- **äº¤äº’å¼è¾“å…¥**ï¼šè¾“å…¥æ—¶ä¸æ˜¾ç¤ºï¼Œé˜²æ­¢æ—äººçœ‹åˆ°

---

## å››ã€åœ¨ Supabase æ‰§è¡Œ SQL

### åšä»€ä¹ˆ
åˆ›å»ºæ•°æ®åº“è¡¨æˆ–ä¿®æ”¹è¡¨ç»“æ„ã€‚

### æ€ä¹ˆåš

**ç¬¬ 1 æ­¥**ï¼šæ‰“å¼€ Supabase Dashboard
```
https://supabase.com/dashboard
```

**ç¬¬ 2 æ­¥**ï¼šé€‰æ‹©é¡¹ç›® â†’ å·¦ä¾§èœå•ç‚¹å‡»ã€ŒSQL Editorã€

**ç¬¬ 3 æ­¥**ï¼šç‚¹å‡»ã€ŒNew queryã€åˆ›å»ºæ–°æŸ¥è¯¢

**ç¬¬ 4 æ­¥**ï¼šå¤åˆ¶ SQL æ–‡ä»¶å†…å®¹ç²˜è´´è¿›å»

ä¾‹å¦‚åˆ›å»º WhatsApp è¡¨ï¼Œå¤åˆ¶ `xk-truck-worker/sql/whatsapp-tables.sql` çš„å†…å®¹

**ç¬¬ 5 æ­¥**ï¼šç‚¹å‡»ã€ŒRunã€æ‰§è¡Œ

**ç¬¬ 6 æ­¥**ï¼šçœ‹åˆ°ç»¿è‰²æç¤ºã€ŒSuccessã€è¡¨ç¤ºæ‰§è¡ŒæˆåŠŸ

### ä¸ºä»€ä¹ˆè¿™æ ·åš
- **SQL Editor**ï¼šå¯è§†åŒ–ç•Œé¢ï¼Œä¾¿äºæ£€æŸ¥å’Œæ‰§è¡Œ
- **SQL æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶**ï¼šè¡¨ç»“æ„å˜æ›´æœ‰è®°å½•ï¼Œå¯è¿½æº¯

---

## äº”ã€ä¿®æ”¹å¯¼èˆªæ 

### åšä»€ä¹ˆ
åœ¨ç½‘ç«™é¡¶éƒ¨å¯¼èˆªæ æ·»åŠ æˆ–ä¿®æ”¹é“¾æ¥ã€‚

### æ€ä¹ˆåš

**ç¬¬ 1 æ­¥**ï¼šæ‰“å¼€æ–‡ä»¶ `xk-truck-frontend/src/components/Header.astro`

**ç¬¬ 2 æ­¥**ï¼šæ‰¾åˆ° `navLinks` æ•°ç»„ï¼ˆçº¦ç¬¬ 2-8 è¡Œï¼‰

```javascript
const navLinks = [
  { href: '/', label: 'Home' },
  { href: '/products', label: 'Products' },
  { href: '/blog', label: 'Blog' },
  { href: '/about', label: 'About Us' },
  { href: '/contact', label: 'Contact' },
];
```

**ç¬¬ 3 æ­¥**ï¼šæ·»åŠ æˆ–ä¿®æ”¹é“¾æ¥

```javascript
// æ·»åŠ æ–°é“¾æ¥
{ href: '/new-page', label: 'New Page' },

// ä¿®æ”¹ç°æœ‰é“¾æ¥
{ href: '/products', label: 'Our Products' },  // æ”¹äº† label
```

**ç¬¬ 4 æ­¥**ï¼šä¿å­˜å¹¶æ¨é€

```bash
git add -A
git commit -m "update navigation links"
git push
```

### ä¸ºä»€ä¹ˆè¿™æ ·åš
- **é›†ä¸­ç®¡ç†**ï¼šæ‰€æœ‰å¯¼èˆªé“¾æ¥åœ¨ä¸€ä¸ªæ•°ç»„ï¼Œä¾¿äºç»´æŠ¤
- **è‡ªåŠ¨æ¸²æŸ“**ï¼šä¿®æ”¹æ•°ç»„åï¼Œé¡µé¢è‡ªåŠ¨æ›´æ–°

---

## å…­ã€ä¿®æ”¹åå°ç®¡ç†å¯¼èˆª

### åšä»€ä¹ˆ
åœ¨åå°ç®¡ç†ç³»ç»Ÿæ·»åŠ æ–°çš„èœå•é¡¹ã€‚

### æ€ä¹ˆåš

**ç¬¬ 1 æ­¥**ï¼šæ‰“å¼€æ–‡ä»¶ `xk-truck-frontend/src/layouts/AdminLayout.astro`

**ç¬¬ 2 æ­¥**ï¼šæ‰¾åˆ° `navItems` æ•°ç»„ï¼ˆçº¦ç¬¬ 14-21 è¡Œï¼‰

```javascript
const navItems = [
  { id: 'dashboard', name: 'Dashboard', href: '/admin/dashboard', icon: 'chart' },
  { id: 'inquiries', name: 'Inquiries', href: '/admin/inquiries', icon: 'mail' },
  { id: 'products', name: 'Products', href: '/admin/products', icon: 'box' },
  { id: 'conversations', name: 'Web Chat', href: '/admin/conversations', icon: 'chat' },
  { id: 'whatsapp', name: 'WhatsApp', href: '/admin/whatsapp', icon: 'whatsapp' },
  { id: 'settings', name: 'Settings', href: '/admin/settings', icon: 'cog' },
];
```

**ç¬¬ 3 æ­¥**ï¼šæ·»åŠ æ–°èœå•é¡¹

```javascript
{ id: 'new-page', name: 'New Page', href: '/admin/new-page', icon: 'chart' },
```

| å­—æ®µ | è¯´æ˜ |
|------|------|
| id | å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºé«˜äº®å½“å‰é¡µ |
| name | æ˜¾ç¤ºåç§° |
| href | é“¾æ¥åœ°å€ |
| icon | å›¾æ ‡åç§°ï¼ˆchart/mail/box/chat/whatsapp/cogï¼‰ |

**ç¬¬ 4 æ­¥**ï¼šå¦‚æœéœ€è¦æ–°å›¾æ ‡ï¼Œåœ¨ä¸‹æ–¹æ¨¡æ¿ä¸­æ·»åŠ å¯¹åº”çš„ SVG

### ä¸ºä»€ä¹ˆè¿™æ ·åš
- **ç»Ÿä¸€ç®¡ç†**ï¼šåå°å¯¼èˆªé›†ä¸­é…ç½®
- **å›¾æ ‡å¤ç”¨**ï¼šé¢„å®šä¹‰çš„å›¾æ ‡ï¼Œä¿æŒé£æ ¼ä¸€è‡´

---

## ä¸ƒã€æŸ¥çœ‹ Worker æ—¥å¿—

### åšä»€ä¹ˆ
å®æ—¶æŸ¥çœ‹ API çš„è¿è¡Œæ—¥å¿—ï¼Œç”¨äºè°ƒè¯•ã€‚

### æ€ä¹ˆåš

**ç¬¬ 1 æ­¥**ï¼šè¿›å…¥ Worker ç›®å½•

```bash
cd d:\github\funNovels\TruckB2B\xk-truck-worker
```

**ç¬¬ 2 æ­¥**ï¼šæ‰§è¡Œæ—¥å¿—å‘½ä»¤

```bash
wrangler tail
```

**ç¬¬ 3 æ­¥**ï¼šçœ‹åˆ°å®æ—¶æ—¥å¿—è¾“å‡º

```
GET /api/health - Ok @ 12/12/2025, 12:00:00 PM
POST /api/chat - Ok @ 12/12/2025, 12:00:05 PM
```

**ç¬¬ 4 æ­¥**ï¼šæŒ‰ `Ctrl + C` åœæ­¢æŸ¥çœ‹

### ä¸ºä»€ä¹ˆè¿™æ ·åš
- **å®æ—¶è°ƒè¯•**ï¼šç«‹å³çœ‹åˆ°è¯·æ±‚å’Œé”™è¯¯
- **æ— éœ€ç™»å½• Dashboard**ï¼šå‘½ä»¤è¡Œç›´æ¥æŸ¥çœ‹

---

## å…«ã€æœ¬åœ°å¼€å‘è°ƒè¯•

### åšä»€ä¹ˆ
åœ¨æœ¬åœ°è¿è¡Œç½‘ç«™è¿›è¡Œå¼€å‘å’Œæµ‹è¯•ã€‚

### æ€ä¹ˆåš

**å‰ç«¯å¼€å‘**ï¼š

```bash
cd d:\github\funNovels\TruckB2B\xk-truck-frontend
npm run dev
```

æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:4321`

**Worker æœ¬åœ°å¼€å‘**ï¼š

```bash
cd d:\github\funNovels\TruckB2B\xk-truck-worker
wrangler dev
```

æœ¬åœ° API åœ°å€ `http://localhost:8787`

### ä¸ºä»€ä¹ˆè¿™æ ·åš
- **å³æ—¶é¢„è§ˆ**ï¼šä¿®æ”¹ä»£ç åè‡ªåŠ¨åˆ·æ–°
- **ä¸å½±å“çº¿ä¸Š**ï¼šæœ¬åœ°æµ‹è¯•ï¼Œç¡®è®¤æ— è¯¯å†éƒ¨ç½²

---

## ä¹ã€æäº¤ä»£ç åˆ° GitHub

### åšä»€ä¹ˆ
ä¿å­˜ä»£ç å˜æ›´å¹¶åŒæ­¥åˆ°è¿œç¨‹ä»“åº“ã€‚

### æ€ä¹ˆåš

**ç¬¬ 1 æ­¥**ï¼šæ·»åŠ æ‰€æœ‰å˜æ›´

```bash
git add -A
```

**ç¬¬ 2 æ­¥**ï¼šæäº¤å˜æ›´ï¼ˆå†™æ¸…æ¥šåšäº†ä»€ä¹ˆï¼‰

```bash
git commit -m "feat: add whatsapp integration"
```

æäº¤ä¿¡æ¯æ ¼å¼ï¼š
- `feat:` æ–°åŠŸèƒ½
- `fix:` ä¿®å¤ bug
- `docs:` æ–‡æ¡£æ›´æ–°
- `style:` æ ·å¼è°ƒæ•´
- `refactor:` ä»£ç é‡æ„

**ç¬¬ 3 æ­¥**ï¼šæ¨é€åˆ° GitHub

```bash
git push
```

### ä¸ºä»€ä¹ˆè¿™æ ·åš
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šå¯ä»¥å›é€€åˆ°ä»»æ„å†å²ç‰ˆæœ¬
- **è‡ªåŠ¨éƒ¨ç½²**ï¼šæ¨é€åå‰ç«¯è‡ªåŠ¨éƒ¨ç½²
- **åä½œåŸºç¡€**ï¼šå¤šäººå¼€å‘çš„åŸºç¡€

---

## åã€CORS æ˜¯ä»€ä¹ˆ

### æ¦‚å¿µ
CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰æ§åˆ¶**å“ªäº›ç½‘ç«™å¯ä»¥è°ƒç”¨ä½ çš„ API**ã€‚

### å½“å‰é…ç½®

```toml
# æ–‡ä»¶ï¼šxk-truck-worker/wrangler.toml
[vars]
CORS_ORIGIN = "https://xk-truck.cn"
```

### æ•ˆæœ

| è¯·æ±‚æ¥æº | èƒ½å¦è°ƒç”¨ API |
|----------|-------------|
| https://xk-truck.cn | âœ… å¯ä»¥ |
| https://å…¶ä»–ç½‘ç«™.com | âŒ è¢«æµè§ˆå™¨æ‹¦æˆª |
| http://localhost:4321 | âŒ è¢«æµè§ˆå™¨æ‹¦æˆª |

### æœ¬åœ°å¼€å‘æ€ä¹ˆåŠ

æ–¹æ³• 1ï¼šä¸´æ—¶ä¿®æ”¹ `wrangler.toml`
```toml
CORS_ORIGIN = "*"  # å…è®¸æ‰€æœ‰æ¥æº
```

æ–¹æ³• 2ï¼šä½¿ç”¨å¼€å‘ç¯å¢ƒéƒ¨ç½²
```bash
wrangler deploy --env=development
```

**æ³¨æ„**ï¼šä¸Šçº¿å‰è¦æ”¹å› `https://xk-truck.cn`

### ä¸ºä»€ä¹ˆè¦é™åˆ¶
- **å®‰å…¨**ï¼šé˜²æ­¢å…¶ä»–ç½‘ç«™ç›—ç”¨ä½ çš„ API
- **é˜²æ»¥ç”¨**ï¼šåªæœ‰ä½ çš„ç½‘ç«™èƒ½è°ƒç”¨

---

*æœ€åæ›´æ–°: 2025-12-12*
